<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Retrieve FileName</title>
  <style>
    .tree ul {
      list-style-type: none;
    }

    .tree li {
      margin: 5px 0;
    }

    .tree .file:before {
      content: ' ';
    }

    .tree .folder:before {
      content: ' ';
    }
  </style>
</head>

<body>

  <h1>File Name</h1>
  <div id="fileName"></div>

  <h2>File Tree</h2>
  <div id="fileTree" class="tree"></div>

  <script>
    // è·å–æ–‡ä»¶å¤¹å†…å®¹
    async function fetchFolderContents (folderPath) {
      const response = await fetch('http://localhost:3001/fetch-files', {
        method: 'GET',
        credentials: 'include' // ç¡®ä¿è¯·æ±‚æºå¸¦cookie
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();
      const files = data.files;
      console.log("files is ", files)
      return files;
    }

    // é€’å½’è·å– `/` ä¹‹å‰çš„å­—ç¬¦ä¸² 
    function extractAllSegments (fullPath) {
      console.log("fullPath is ", fullPath)
      // å¯»æ‰¾ç¬¬ä¸€ä¸ªæ–œæ çš„ç´¢å¼•
      const index = fullPath.indexOf('/');

      // å¦‚æœæ‰¾ä¸åˆ°æ–œæ ï¼Œåˆ™è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºç»“æœ
      if (index === -1) {
        return [fullPath]; // è¿”å›åŒ…å«å½“å‰è·¯å¾„çš„æ•°ç»„ä½œä¸ºæœ€ç»ˆç»“æœ
      }

      // æˆªå–ç¬¬ä¸€ä¸ªæ–œæ ä¹‹å‰çš„éƒ¨åˆ†ä½œä¸ºå½“å‰å±‚çº§è·¯å¾„
      const segment = fullPath.substring(0, index);

      // é€’å½’è°ƒç”¨ï¼Œå¤„ç†å‰©ä½™è·¯å¾„éƒ¨åˆ†
      const restPath = fullPath.substring(index + 1);
      const segments = extractAllSegments(restPath);

      // å°†å½“å‰å±‚çº§è·¯å¾„åŠ å…¥ç»“æœæ•°ç»„ä¸­
      segments.unshift(segment);

      return segments;
    }

    // æ¸²æŸ“æ–‡ä»¶æ ‘
    async function renderTree (files, basePath) {
      const ul = document.createElement('ul');

      for (const file of files) {
        console.log("æ–‡ä»¶", file)
        const li = document.createElement('li');

        const firstSegment = extractAllSegments(file);
        console.log(firstSegment); // è¾“å‡º: '553dc65fec23f58f97c0f37d36f27fc0'

        if (isFolder) {
          const folderName = file.substring(0, index);
          li.className = 'folder';
          li.innerHTML = `<span>ğŸ“ ${folderName}</span>`;
          // const subFiles = await fetchFolderContents(`${basePath}/${folderName}`);
          // const subTree = await renderTree(subFiles, `${basePath}/${folderName}`);
          li.appendChild(subTree);
        } else {
          li.className = 'file';
          li.innerHTML = `<span>ğŸ“„ ${fileName}</span>`;
        }

        ul.appendChild(li);
      }


      return ul;
    }






    // æ›´æ–° UI
    async function updateUI (folderName) {
      const fileNameElement = document.getElementById('fileName');
      fileNameElement.textContent = folderName;

      try {
        const files = await fetchFolderContents(folderName);
        const treeElement = renderTree(files, folderName);
        document.getElementById('fileTree').appendChild(treeElement);
      } catch (error) {
        console.error('Error:', error);
      }
    }

    // å‘é€ POST è¯·æ±‚åˆ°æœåŠ¡å™¨è·å– folderName
    fetch('http://localhost:3001/user-file', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      // body: JSON.stringify({ userId: '123' }) // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹å‘é€çš„æ•°æ®
    })
      .then(response => response.json())
      .then(data => {
        updateUI(data.folderName); // ä½¿ç”¨ä»æœåŠ¡å™¨è¿”å›çš„ folderName æ›´æ–° UI
      })
      .catch(error => {
        console.error('Error:', error);
      });
  </script>
</body>

</html> -->



<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Retrieve FileName</title>
  <style>
    .tree ul {
      list-style-type: none;
    }

    .tree li {
      margin: 5px 0;
    }

    .tree .file:before {
      content: 'ğŸ“„ ';
    }

    .tree .folder:before {
      content: 'ğŸ“ ';
    }
  </style>
</head>

<body>

  <h1>File Name</h1>
  <div id="fileName"></div>

  <h2>File Tree</h2>
  <div id="fileTree" class="tree"></div>

  <script>
    // è·å–æ–‡ä»¶å¤¹å†…å®¹
    async function fetchFolderContents () {
      const response = await fetch('http://localhost:3001/fetch-files', {
        method: 'GET',
        credentials: 'include' // ç¡®ä¿è¯·æ±‚æºå¸¦cookie
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();
      const files = data.files;
      console.log("files is ", files)
      return files;
    }


    // å‡è®¾è¿™æ˜¯ä»æœåŠ¡å™¨è·å–çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨



    // æ„å»ºæ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„æ ‘å½¢ç»“æ„
    function buildTree (filePaths) {
      const tree = {};

      filePaths.forEach(path => {
        const parts = path.split('/');
        let current = tree;

        for (let i = 0; i < parts.length; i++) {
          const part = parts[i];
          if (!current[part]) {
            current[part] = {};
          }
          current = current[part];
        }
      });

      return tree;
    }

    // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘
    function renderTree (tree, path = '') {
      const ul = document.createElement('ul');

      for (const [name, content] of Object.entries(tree)) {
        const li = document.createElement('li');
        const isFolder = typeof content === 'object' && Object.keys(content).length > 0;
        // const iconName = isFolder ? 'ğŸ“' : 'ğŸ“„';
        const finalPath = path ? `${path}/${name}` : name;

        li.className = isFolder ? 'folder' : 'file';
        // li.innerHTML = `<span>${iconName}${name}</span>`;
        li.innerHTML = `<span>${name}</span>`;
        ul.appendChild(li);

        if (isFolder) {
          const subtree = renderTree(content, finalPath);
          li.appendChild(subtree);
        }
      }

      return ul;
    }

    // æ›´æ–° UI
    async function updateUI () {
      const files = await fetchFolderContents();
      console.log("files is ", files)
      const tree = buildTree(files);
      const treeElement = renderTree(tree);
      document.getElementById('fileTree').appendChild(treeElement);
    }



    // é¡µé¢åŠ è½½å®Œæ¯•åæ›´æ–° UI
    document.addEventListener('DOMContentLoaded', updateUI);
    // å‘é€ POST è¯·æ±‚åˆ°æœåŠ¡å™¨è·å– folderName
    // fetch('http://localhost:3001/user-file', {
    //   method: 'POST',
    //   headers: {
    //     'Content-Type': 'application/json'
    //   },
    // })
    //   .then(response => response.json())
    //   .then(data => {
    //     updateUI(data.folderName); // ä½¿ç”¨ä»æœåŠ¡å™¨è¿”å›çš„ folderName æ›´æ–° UI
    //     console.log("data is ", data)
    //   })
    //   .catch(error => {
    //     console.error('Error:', error);
    //   });
  </script>
</body>

</html>